<!DOCTYPE html>
<html>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "Roboto", sans-serif;
      background-color: #f4f4f4;
      color: #333;
      padding: 20px;
      margin: 0;
      height: 2000px;
    }
    h3 {
      color: #2a2a2a;
      font-weight: 500;
    }
    input,
    button {
      font-family: "Roboto", sans-serif;
      padding: 12px 15px;
      margin-top: 8px;
      width: 100%;
      box-sizing: border-box;
      border: 2px solid #ddd;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    input:focus {
      border-color: #0056b3;
      box-shadow: 0 0 8px rgba(0, 86, 179, 0.2);
    }
    button {
      background-image: linear-gradient(45deg, #6ab04c, #26de81);
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    button:hover {
      background-image: linear-gradient(45deg, #26de81, #6ab04c);
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.15);
    }
    div {
      margin-top: 10px;
      padding: 15px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    #finalPayloadPreview {
      background-color: #e8f8f5;
      border-left: 5px solid #26de81;
    }
    p {
      margin: 10px 0;
    }
  </style>
  <body>
    <h3>Customize and Preview Image</h3>
    <p>
      Tone:
      <input
        type="text"
        id="tone"
        placeholder="Enter tone here"
        style="width: 90%"
      />
    </p>
    <p>
      Format:
      <input
        type="text"
        id="format"
        placeholder="Enter format here"
        style="width: 90%"
      />
    </p>

    <button id="preview">Show Preview</button>
    <div id="previewContainer" style="margin-top: 20px; display: none">
      <img
        id="imageDisplay"
        style="max-width: 100%; display: block; margin-top: 10px"
      />
      <p>
        Description:
        <input
          type="text"
          id="description"
          placeholder="Enter Description here"
          style="width: 90%"
        />
      </p>
    </div>
    <button id="finalPayload">Generate US</button>
    <div
      id="finalPayloadPreview"
      style="
        margin-top: 20px;
        display: none;
        background-color: #f0f0f0;
        padding: 10px;
      "
    >
      <p><strong>Tone:</strong> <span id="displayTone"></span></p>
      <p><strong>Format:</strong> <span id="displayFormat"></span></p>
      <p><strong>Description:</strong> <span id="displayDescription"></span></p>
      <img
        id="finalImageDisplay"
        style="max-width: 100%; display: block; margin-top: 10px"
      />
    </div>
    <script>
      const previewButton = document.getElementById("preview");
      const finalPayloadButton = document.getElementById("finalPayload");
      const imageDisplay = document.getElementById("imageDisplay");
      const previewContainer = document.getElementById("previewContainer");
      const finalPayloadPreview = document.getElementById(
        "finalPayloadPreview"
      );
      const displayTone = document.getElementById("displayTone");
      const displayFormat = document.getElementById("displayFormat");
      const displayDescription = document.getElementById("displayDescription");
      const toneInput = document.getElementById("tone");
      const formatInput = document.getElementById("format");
      const descriptionInput = document.getElementById("description");

      previewButton.onclick = () => {
        parent.postMessage({ pluginMessage: { type: "export-png" } }, "*");
      };

      finalPayloadButton.onclick = () => {
        displayTone.textContent = toneInput.value;
        displayFormat.textContent = formatInput.value;
        displayDescription.textContent = descriptionInput.value;
        finalImageDisplay.src = imageDisplay.src;
        finalPayloadPreview.style.display = "block";
      };

      onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (msg.type === "exported-jpg" && msg.bytes) {
          const binaryString = msg.bytes.reduce(
            (data, byte) => data + String.fromCharCode(byte),
            ""
          );
          const base64 = btoa(binaryString);
          const link = document.createElement("a");
          link.href = `data:image/jpeg;base64,${base64}`;
          link.download = "image.jpg";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }
      };
    </script>
  </body>
</html>
